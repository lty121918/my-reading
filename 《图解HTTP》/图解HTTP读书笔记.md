# 《图解HTTP》读书笔记

## TCP/IP协议族按层次分为以下四层

![](https://gitee.com/ekzodia_lty/blog-image/raw/master/img/20220202214600.png)

## 确保可靠性的TCP协议

**按层次分，TCP位于传输层，提供可靠的字节流服务 **

>  所谓字节流服务是指，为了方便传输，将大块的数据分割成以报文段为单位的数据包进行管理。

为了准确无误将数据送达某处，TCP协议采用了三次握手策略，用TCP协议把数据包送出去后，TCP不会对传送后的情况置之不理，它一定会向对方确认是否成功送达。

### 三次握手

握手过程中使用了TCP的标志（flag）——SYN（synchronize）和ACK（acknowledgement）

> synchronize 使同步; (使)同步，在时间上一致，同速进行;
>
> acknowledgement 确认; 感谢; (对事实、现实、存在的)承认; 谢礼; 收件复函; 致谢，鸣谢;

发送端首先发送一个带有SYN标志的数据包给对方。接收端收到后，回传带有SYN/ACK标志的数据包以示传达确认信息。最后，发送端再回传一个带有ACK标志的数据包，代表“握手”结束。

若在握手过程中某个阶段莫名中断，TCP协议会再次以相同的顺序发送相同的数据包。

![](https://gitee.com/ekzodia_lty/blog-image/raw/master/img/image-20220110234446209.png)

除了三次握手，TCP协议还有其他各种手段来保证通信的可靠性。

## 负责域名解析的DNS服务

**DNS服务是和HTTP协议一样位于应用层的协议。它提供域名到IP地址之间的解析服务**。

**DNS协议提供通过域名查找IP地址，或逆向从IP地址发查域名的服务。**



## HTTP是不保存状态的协议

HTTP是一种不保存状态，即无状态协议。HTTP协议自身不对请求和响应之间的通信状态进行保存。也就是说在HTTP这个级别，协议对于发送过的请求或响应都不做持久化处理，HTTP协议自身不具备保存之前发送过的请求或者响应的功能。

HTTP1.1虽然是无状态协议，但是为了实现期望的保持功能，于是引入了Cookie技术。

## HTTP1.1中可使用的方法

### GET：获取资源

### POST：传输实体主题

### PUT：传输文件

鉴于HTTP/1.1的PUT方法自身不带验证机制，任何人都可以上传文件，存在安全性问题，因此一般的Web网站不使用该方法。

### HEAD：获得报文首部（获得通信状态）

HEAD方法和GET方法一样，只是不返回报文主体部分。用于确认URI的有效性及资源更新的日期时间等。

### DELETE：删除文件

与PUT方法一样不带验证机制，所以一般网站也不使用DELETE方法。

### OPTIONS：询问支持的方法

OPTIONS方法用来查询针对请求URI指定资源的方法。

### TRACE：追踪路径

TRACE方法是让Web服务器端将之前的请求通信环回给客户的方法。客户端通过TRACE方法可以查询发送出去的请求是怎样被加工/篡改的。但是因为TRACE本来就不常用，再加上它容易引发XST攻击，通常就更不会用到了。

### CONNECT：要求用隧道协议连接代理

CONNECT方法要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。主要使用SSL安全套接层和TLS传输层安全协议把通信内容加密后经网络隧道传输。

![](https://gitee.com/ekzodia_lty/blog-image/raw/master/img/image-20220112230158080.png)



## HTTP状态码

### 状态码的类别

![](https://gitee.com/ekzodia_lty/blog-image/raw/master/img/image-20220115182031227.png)

### 2XX 成功

200：客户端发来的请求在服务端被正常处理。

204：表示该服务接收的请求已经成功处理，但在返回的响应报文中不含实体的主体部分。一般只在需要从客户端往服务端发送信息，对客户端不需要发送新信息内容的情况下使用。

206：表示客户端进行了范围请求，而服务器成功执行了这部分GET请求。

### 3XX 重定向

> 3XX响应结果表明浏览器需要执行某些特殊的处理以正确处理请求。

301：永久性重定向。该状态码表示请求的资源已经被分配了新的URI，以后应使用资源现在所指的URI。

302：临时重定向。该状态码表示请求的资源已经被分配给了新的URI，希望用户本次能够使用新的URI访问。

303：该状态码表示由于请求对应的资源存在着另一个URI，应使用GET方法定向获取请求的资源。（明确使用GET方法获得资源，与302有所区别）

304：表示客户端发送附带条件的请求时，服务器端允许请求访问资源，但未满足条件的情况。304状态码返回时，不包含任何响应的主体部分。304虽然被划分在3XX当中，但是和重定向没有关系。

307：临时重定向。该状态码与302有着相同的意义。



### 4XX 客户端错误

400：表示请求报文中存在语法错误。当错误发生时，需修改请求的内容后再次发送请求。另外，浏览器回向200 OK一样对待该状态码。

401：该状态码发送的请求需要有通过HTTP认证的认证信息。另外若之前已经进行过1次请求，则表示用户认证失败。

403：表示对请求资源的访问被服务器拒绝了。未获得文件系统的访问授权、访问权限等情况都可能是发生403的原因。

404：表示服务器上无法找到请求的资源。除此之外，也可以在服务端拒绝请求且不想说明理由时使用。

### 5XX 服务器错误

500：表示服务器在执行请求时发生了错误。也有可能是Web应用存在的bug或某些临时的故障。

503：表示服务器暂时处于超负载或正在进行停机维护，现在无法处理请求。

## 与HTTP协作的Web服务器

在互联网上，域名通过DNS服务映射到IP地址（域名解析）之后访问目标网站。

### 通信数据转发程序：代理、网关、隧道

+ 代理服务器的基本行为就是接收客户端发送的请求后转发给其他服务器。代理不改变请求URI，会直接发送给前方持有资源的目标服务器。
+ 网关工作机制与代理十分相似。而网关能使通信线路上的服务器提供非HTTP协议服务。（可以提高通信安全性）
+ 隧道可按要求简历起一条与其他服务器连接的线路，使用SSL等手段进行加密。隧道的目的是确保客户端和服务端进行安全的通信。



## HTTP/1.1首部字段一览

### 通用首部字段

指请求报文和响应报文双方都会使用的首部。

![](https://gitee.com/ekzodia_lty/blog-image/raw/master/img/image-20220122135441449.png)

### 请求首部字段

![](https://gitee.com/ekzodia_lty/blog-image/raw/master/img/image-20220122135453783.png)

### 响应首部字段

![](https://gitee.com/ekzodia_lty/blog-image/raw/master/img/image-20220122141312126.png)

### 实体首部字段

![](https://gitee.com/ekzodia_lty/blog-image/raw/master/img/image-20220122141333624.png)



## HTTPS

HTTP协议中没有加密机制，但可以通过SSL安全套接层或TLS安全传输协议的组合使用，加密HTTP的通信内容。

与SSL组合使用的HTTP被称为HTTPS（HTTP Secure，超文本传输安全协议）或HTTP over SSL。

**HTTPS也存在一些问题，就是使用SSL的时候，速度会比HTTP慢，SSL的慢分两种，一种是指通信慢。另一种是指由于大量消耗CPU及内存等资源，导致处理速度变慢。**

不一直使用HTTPS的原因是：加密通信会消耗更多的CPU及内存资源，另一方面是节省购买证书的开销。



## 基于HTTP的功能追加协议

### 基于HTTP的协议

HTTP功能上的不足可以创建一套全新的协议来补充。可是目前基于
HTTP的Web浏览器的使用环境已经遍布全球，因此无法完全抛弃HTTP。

**HTTP标准的瓶颈：**

+ 一条连接上只可发送一个请求
+ 请求只能从客户端开始。客户端不可以接收除响应以外的指令。
+ 请求/响应首部未经压缩就发送。首部信息越多延迟越大。
+ 发送冗长的首部。每次互相发送的的相同首部造成的浪费较多。
+ 可任意选择数据压缩格式。非强制压缩发送。

### 消除HTTP瓶颈的SPDY

开发目标：解决HTTP的性能瓶颈，缩短Web页面的加载时间。
（50%）

SPDY没有完全改写HTTP协议，而是在TCP/IP的应用层与运输层之间通过新加会话层的形式运作。同时，考虑到安全性问题，sPDY规定通信中使用SSL。 

使用SPDY之后，HTTP协议额外获得以下功能：

1. 多路复用流
2. 赋予请求优先级
3. 压缩HTTP首部
4. 推送功能
5. 服务器提示功能

### 使用浏览器进行全双工通信的WebSocket

**WebSocket，即Web浏览器与Web服务器之间全双工通信标准。**

一旦Web服务器与客户端之间建立起WebSocket协议进行通信连接，之后所有的通信都依靠之歌专用协议进行。通信过程中可互相发送JSON、XML、HTML或图片等任意格式的数据。

**WebSocket协议的主要特点：**

+ 推送功能

  服务器可以直接发送数据，而不必等待而客户端的请求。

+ 减少通信量

  只要建立起WebSocket连接，就希望一直保持连接状态。而且WebSocket的首部信息很小，通信量也相应减少。

### HTTP/2.0

书中时间是12年，2.0尚未正式发布。

目标：改善用户在使用Web时的速度体验。

### Web服务器管理文件的WebDAV

基于万维往的分布式创作和版本控制，是一个可对Web服务器上的内容直接进行文件复制、编辑等操作的分布式文件系统。作为扩展HTTP/1.1的协议定义在RFC4918。

具有创建文件、删除文件、文件创建者管理、文件编辑过程中禁止其他用户内容覆盖的加锁功能，以及对文件内容修改的版本控制功能。   

## Web的攻击技术

对Web应用的攻击模式有两种：

+ 主动攻击：SQL注入攻击和OS命令注入攻击
+ 被动攻击：跨站脚本攻击XXS、跨站请求伪造CSRF、HTTP首部注入攻击

其他攻击：会话劫持、目录遍历攻击、邮件首部注入攻击、会话固定攻击、点击攻击、DOS攻击
